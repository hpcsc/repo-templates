version: '3'

tasks:
  unit:
    cmds:
      - gotestsum --format pkgname-and-test-fails -- -tags=unit -race -cover -covermode=atomic -coverprofile=coverage-unit.out ./...

  e2e:
    cmds:
      - git submodule update --init --recursive
      - docker build -t cli-e2e ./e2e
      - docker container run --rm -e EXECUTABLE -v $PWD:/app cli-e2e
    env:
      EXECUTABLE: ./dist/{{.ProjectKebab}}

  shellcheck:
    cmds:
      - find ./scripts -type f -name '*.sh' | xargs shellcheck -S error
      - shellcheck -S error ./hooks/*

  vulnerabilities:
    cmds:
      - govulncheck ./...
